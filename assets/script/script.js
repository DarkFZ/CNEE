const speciesData = [
  {
    name: "Anthoceros punctatus",
    scientificName: "Anthoceros punctatus",
    status: "Perigo",
    description: "Com talo em forma roseta, com cavidades mucilaginosas visíveis como pontos escuros. Esporófitos com a forma de chifre ou vagem, surgindo cedo no talo. Cápsulas castanho escuras quando maduras. Anterídios maduros com pedúnculo e cerca de 100-120(-150) μm de comprimento.",
    habitat: "Solo fresco a húmido, arenoso-argiloso ou argiloso, com baixo teor de cálcio, pH neutro a ligeiramente ácido ou ligeiramente básico.",
    distribution: "Santiago",
    ecology: "Importante na retenção de água e prevenção da erosão do solo",
    pdfUrl: "/Docs/Anthoceros-punctatus-agrestis.pdf",
    imgUrl: "https://www.britishbryologicalsociety.org.uk/wp-content/uploads/2021/02/Anthocerospunctatus.jpg"
  },
  {
    name: "Lophocolea bidentata (L.) Dumort.",
    scientificName: "Lophocolea bidentata (L.) Dumort.",
    status: "Perigo",
    description: "Com talo estreito, com ramificações laterais. Filóides alternos, simétricos, retangulares-ovados, com ponta dividida e dentes espaçados. Parte inferior dos filóides livres e dividida em 2/3. Carateriza-se por filóides simétricos retangular-ovados com ponta dividida e parte inferior livre.",
    habitat: "Em encostas de solo, madeira em decomposição, cascas deárvores ou rochas, até 1500 m de altitude.",
    distribution: "Fogo",
    ecology: "Indicadora de qualidade ambiental em ecossistemas montanhosos",
    pdfUrl: "/Docs/Lophocolea-bidentata.pdf",
    imgUrl: "https://www.britishbryologicalsociety.org.uk/wp-content/uploads/2021/12/2020-02-07-17-38-53-800x600.jpg"
  },
  {
    name: "Acrolejeunea emergens (Mitt.) Steph.",
    scientificName: "Acrolejeunea emergens (Mitt.) Steph. Brid.",
    status: "Critico",
    description: "Com talo, de 1 a 3 cm de comprimento e 1,0 a 2,3 mm de largura. Cor verde quando húmido, amarelado-avermelhado ou acinzentado quando seco. Ramificações curtas ou longas, variando entre tipos Lejeunea (geralmente sexuais) e tipos Frullania (vegetativos). Caulóide com células corticais ventrais de paredes finas. Filóides imbricados junto de cauloides quando secos, abertos e curvados quando húmidos. Lobo de filóide com forma variável, com base dorsal pouco auriculada e ápice arredondado.",
    habitat: "Frequente na casca de árvores, troncos ou rochas",
    distribution: "Cabo Verde",
    ecology: "Pioneira na colonização de rochas, contribuindo para formação de solo",
    pdfUrl: "https://api.gbif.org/v1/image/cache/fit-in/500x/occurrence/3334477304/media/6e5ed555f56e25f57fb1f8ce4323ac40",
    imgUrl: "https://api.gbif.org/v1/image/cache/fit-in/500x/occurrence/3334477304/media/6e5ed555f56e25f57fb1f8ce4323ac40"
  },
  {
    name: "Anthoceros punctatus",
    scientificName: "Anthoceros punctatus",
    status: "Perigo",
    description: "Com talo em forma roseta, com cavidades mucilaginosas visíveis como pontos escuros. Esporófitos com a forma de chifre ou vagem, surgindo cedo no talo. Cápsulas castanho escuras quando maduras. Anterídios maduros com pedúnculo e cerca de 100-120(-150) μm de comprimento.",
    habitat: "Solo fresco a húmido, arenoso-argiloso ou argiloso, com baixo teor de cálcio, pH neutro a ligeiramente ácido ou ligeiramente básico.",
    distribution: "Santiago",
    ecology: "Importante na retenção de água e prevenção da erosão do solo",
    pdfUrl: "/Docs/Anthoceros-punctatus-agrestis.pdf",
    imgUrl: "https://www.britishbryologicalsociety.org.uk/wp-content/uploads/2021/02/Anthocerospunctatus.jpg"
  },
  {
    name: "Lophocolea bidentata (L.) Dumort.",
    scientificName: "Lophocolea bidentata (L.) Dumort.",
    status: "Perigo",
    description: "Com talo estreito, com ramificações laterais. Filóides alternos, simétricos, retangulares-ovados, com ponta dividida e dentes espaçados. Parte inferior dos filóides livres e dividida em 2/3. Carateriza-se por filóides simétricos retangular-ovados com ponta dividida e parte inferior livre.",
    habitat: "Em encostas de solo, madeira em decomposição, cascas deárvores ou rochas, até 1500 m de altitude.",
    distribution: "Fogo",
    ecology: "Indicadora de qualidade ambiental em ecossistemas montanhosos",
    pdfUrl: "/Docs/Lophocolea-bidentata.pdf",
    imgUrl: "https://www.britishbryologicalsociety.org.uk/wp-content/uploads/2021/12/2020-02-07-17-38-53-800x600.jpg"
  },
  {
    name: "Acrolejeunea emergens (Mitt.) Steph.",
    scientificName: "Acrolejeunea emergens (Mitt.) Steph. Brid.",
    status: "Perigo",
    description: "Com talo, de 1 a 3 cm de comprimento e 1,0 a 2,3 mm de largura. Cor verde quando húmido, amarelado-avermelhado ou acinzentado quando seco. Ramificações curtas ou longas, variando entre tipos Lejeunea (geralmente sexuais) e tipos Frullania (vegetativos). Caulóide com células corticais ventrais de paredes finas. Filóides imbricados junto de cauloides quando secos, abertos e curvados quando húmidos. Lobo de filóide com forma variável, com base dorsal pouco auriculada e ápice arredondado.",
    habitat: "Frequente na casca de árvores, troncos ou rochas",
    distribution: "Cabo Verde",
    ecology: "Pioneira na colonização de rochas, contribuindo para formação de solo",
    pdfUrl: "https://api.gbif.org/v1/image/cache/fit-in/500x/occurrence/3334477304/media/6e5ed555f56e25f57fb1f8ce4323ac40",
    imgUrl: "https://api.gbif.org/v1/image/cache/fit-in/500x/occurrence/3334477304/media/6e5ed555f56e25f57fb1f8ce4323ac40"
  },
  {
    name: "Anthoceros punctatus",
    scientificName: "Anthoceros punctatus",
    status: "Perigo",
    description: "Com talo em forma roseta, com cavidades mucilaginosas visíveis como pontos escuros. Esporófitos com a forma de chifre ou vagem, surgindo cedo no talo. Cápsulas castanho escuras quando maduras. Anterídios maduros com pedúnculo e cerca de 100-120(-150) μm de comprimento.",
    habitat: "Solo fresco a húmido, arenoso-argiloso ou argiloso, com baixo teor de cálcio, pH neutro a ligeiramente ácido ou ligeiramente básico.",
    distribution: "Santiago",
    ecology: "Importante na retenção de água e prevenção da erosão do solo",
    pdfUrl: "/Docs/Anthoceros-punctatus-agrestis.pdf",
    imgUrl: "https://www.britishbryologicalsociety.org.uk/wp-content/uploads/2021/02/Anthocerospunctatus.jpg"
  },
  {
    name: "Lophocolea bidentata (L.) Dumort.",
    scientificName: "Lophocolea bidentata (L.) Dumort.",
    status: "Perigo",
    description: "Com talo estreito, com ramificações laterais. Filóides alternos, simétricos, retangulares-ovados, com ponta dividida e dentes espaçados. Parte inferior dos filóides livres e dividida em 2/3. Carateriza-se por filóides simétricos retangular-ovados com ponta dividida e parte inferior livre.",
    habitat: "Em encostas de solo, madeira em decomposição, cascas deárvores ou rochas, até 1500 m de altitude.",
    distribution: "Fogo",
    ecology: "Indicadora de qualidade ambiental em ecossistemas montanhosos",
    pdfUrl: "/Docs/Lophocolea-bidentata.pdf",
    imgUrl: "https://www.britishbryologicalsociety.org.uk/wp-content/uploads/2021/12/2020-02-07-17-38-53-800x600.jpg"
  },
  {
    name: "Acrolejeunea emergens (Mitt.) Steph.",
    scientificName: "Acrolejeunea emergens (Mitt.) Steph. Brid.",
    status: "Perigo",
    description: "Com talo, de 1 a 3 cm de comprimento e 1,0 a 2,3 mm de largura. Cor verde quando húmido, amarelado-avermelhado ou acinzentado quando seco. Ramificações curtas ou longas, variando entre tipos Lejeunea (geralmente sexuais) e tipos Frullania (vegetativos). Caulóide com células corticais ventrais de paredes finas. Filóides imbricados junto de cauloides quando secos, abertos e curvados quando húmidos. Lobo de filóide com forma variável, com base dorsal pouco auriculada e ápice arredondado.",
    habitat: "Frequente na casca de árvores, troncos ou rochas",
    distribution: "Cabo Verde",
    ecology: "Pioneira na colonização de rochas, contribuindo para formação de solo",
    pdfUrl: "https://api.gbif.org/v1/image/cache/fit-in/500x/occurrence/3334477304/media/6e5ed555f56e25f57fb1f8ce4323ac40",
    imgUrl: "https://api.gbif.org/v1/image/cache/fit-in/500x/occurrence/3334477304/media/6e5ed555f56e25f57fb1f8ce4323ac40"
  }
];

const wordLimit = 20;

function createSpeciesCard(species) {
  const statusClass = `status-${species.status.toLowerCase().replace(/\s+/g, '-')}`;

  return `
    <div class="species-card" 
         onclick="showSpeciesDetail('${species.name}')"
         role="button"
         tabindex="0"
         aria-label="Detalhes de ${species.name}">
      <div  style="width: 100%; height: 100%; background-image: url('${species.imgUrl}'); background-size: cover; background-position: center;"
 class="species-image">
      </div>
      <div class="species-name-overlay">
        <h3>${species.name}</h3>
      </div>
      <div class="species-info">
        <h3>${species.name}</h3>
        <span class="scientific-name">${species.scientificName}</span>
        <p class="description">${truncateDescription(species.description)}.</p>
        <p><strong>Habitat:</strong> ${species.habitat}</p>
        <p><strong>Distribuição:</strong> ${species.distribution}</p>
        <span class="conservation-status ${statusClass}">${species.status}</span>
        <a style="color: rgba(0, 0, 255, 0.771);"><strong>More info on Click...</strong></a>
      </div>
    </div>
  `;
}

function showSpeciesDetail(speciesName) {
  const species = speciesData.find(s => s.name === speciesName);
  const modal = document.getElementById('speciesModal');
  const modalContent = document.getElementById('modalContent');

  modalContent.innerHTML = `
    <div id="speciebg" style="background-image: url('${species.imgUrl}');"></div>
    <div id="corp">
    <h2>${species.name}</h2>
    <h3><em>${species.scientificName}</em></h3>
    <p><strong>Status:</strong> ${species.status}</p>
    <p><strong>Habitat:</strong> ${species.habitat}</p>
    <p><strong>Distribuição:</strong> ${species.distribution}</p>
    <p><strong>Relevância Ecológica:</strong> ${species.ecology}</p>
    <p><strong>Descrição:</strong> ${species.description}</p>
    <a href="${species.pdfUrl}" class="download-btn" target="_blank">
      <i class="fas fa-download"></i> Download PDF
    </a></div>
  `;

  modal.style.display = 'block';
}

document.getElementById('closeModal').addEventListener('click', () => {
  document.getElementById('speciesModal').style.display = 'none';
});

document.getElementById('searchInput').addEventListener('input', (e) => {
  const searchTerm = e.target.value.toLowerCase();
  const filteredSpecies = speciesData.filter(species =>
    species.name.toLowerCase().includes(searchTerm) ||
    species.scientificName.toLowerCase().includes(searchTerm) ||
    species.description.toLowerCase().includes(searchTerm) || 
    species.distribution.toLowerCase().includes(searchTerm)
  );
  renderSpecies(filteredSpecies);
});

const menuToggle = document.getElementById('menuToggle');
const navLinks = document.querySelector('.nav-links');

menuToggle.addEventListener('click', () => {
  const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
  menuToggle.setAttribute('aria-expanded', !isExpanded);
  navLinks.classList.toggle('active');
});

// Intersection Observer for fade-in animations
const observerOptions = {
  threshold: 0.1,
  rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
      observer.unobserve(entry.target);
    }
  });
}, observerOptions);

// Observe all fade-in elements
document.querySelectorAll('.fade-in').forEach(element => {
  observer.observe(element);
});

// Improved keyboard navigation
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    const modal = document.getElementById('speciesModal');
    if (modal.style.display === 'block') {
      modal.style.display = 'none';
    }
  }

  if (e.key === 'Enter' && e.target.classList.contains('species-card')) {
    const speciesName = e.target.querySelector('h3').textContent;
    showSpeciesDetail(speciesName);
  }
});

function renderSpecies(speciesList) {
  const grid = document.getElementById('speciesGrid');
  grid.innerHTML = speciesList.map(species => createSpeciesCard(species)).join('');
}

// Add filter event listeners
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');

    const filter = e.target.dataset.filter;
    const filteredSpecies = filter === 'all'
      ? speciesData
      : speciesData.filter(species =>
        species.status.toLowerCase().includes(filter.toLowerCase())
      );

    renderSpecies(filteredSpecies);
  });
});

// Smooth scroll behavior for navigation links
document.querySelectorAll('.nav-links a').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const sectionId = this.getAttribute('href');
    const section = document.querySelector(sectionId);

    if (section) {
      section.scrollIntoView({ behavior: 'smooth' });

      // Close mobile menu if open
      if (navLinks.classList.contains('active')) {
        navLinks.classList.remove('active');
        menuToggle.setAttribute('aria-expanded', 'false');
      }
    }
  });
});

// Add active state to nav links based on scroll position
window.addEventListener('scroll', () => {
  const sections = document.querySelectorAll('section');
  const navLinks = document.querySelectorAll('.nav-links a');

  let currentSection = '';

  sections.forEach(section => {
    const sectionTop = section.offsetTop - 100;
    const sectionHeight = section.clientHeight;
    if (pageYOffset >= sectionTop && pageYOffset < sectionTop + sectionHeight) {
      currentSection = section.getAttribute('id');
    }
  });

  navLinks.forEach(link => {
    link.classList.remove('active');
    if (link.getAttribute('href').substring(1) === currentSection) {
      link.classList.add('active');
    }
  });
});

// Close modal when clicking outside
window.onclick = function (event) {
  const modal = document.getElementById('speciesModal');
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

// Handle scroll events for navbar background change
window.addEventListener('scroll', () => {
  const navbar = document.querySelector('.navbar');
  if (window.scrollY > 50) { // Change this value to adjust when the background appears
    navbar.classList.add('scrolled');
  } else {
    navbar.classList.remove('scrolled');
  }
});

function truncateDescription(description) {
  if (!description) return ''; // Se a descrição for vazia ou indefinida, retorna uma string vazia
  const words = description.split(' '); // Divide a descrição em palavras
  if (words.length > wordLimit) {
    return words.slice(0, wordLimit).join(' ') + '...'; // Mantém apenas o limite e adiciona "..."
  }
  return description; // Retorna a descrição original se estiver dentro do limite
}


// Initial render
renderSpecies(speciesData);
